"use strict";(self.webpackChunktracker=self.webpackChunktracker||[]).push([[550],{7550:(a,t,e)=>{e.d(t,{initializeDatabase:()=>h});var n=e(2555),o=e(5806),s=e(2631),r=e(7949),i=e(9119);function c(a){const t=(0,i.a)(a).getDay();return 0===t||6===t}var d=e(7426);const l=[{PK:"U-12345",FirstName:"Ellis",LastName:"Taylor",AnnualGross:48e3,Pension:1450,NationalIns:5e3},{PK:"U-67890",FirstName:"Sarah",LastName:"Johnson",AnnualGross:52e3,Pension:1560,NationalIns:5200},{PK:"U-11111",FirstName:"Michael",LastName:"Chen",AnnualGross:45e3,Pension:1350,NationalIns:4800}],u=[{PK:"G-001",Title:"Digital Health Innovation Project",StartDate:"2024-10-01",EndDate:"2025-09-30",ManagerUserID:"U-12345"},{PK:"G-002",Title:"AI Research Initiative",StartDate:"2024-12-01",EndDate:"2025-11-30",ManagerUserID:"U-67890"},{PK:"G-003",Title:"Sustainable Technology Development",StartDate:"2025-01-01",EndDate:"2025-12-31",ManagerUserID:"U-11111"}],g=(a,t)=>{const e={};return(0,s.k)({start:a,end:t}).forEach((a=>{const t=(0,r.GP)(a,"yyyy-MM-dd");e[t]=!c(a)})),e},y=(a,t)=>{const e={};return(0,s.k)({start:a,end:t}).forEach((a=>{const t=(0,r.GP)(a,"yyyy-MM-dd");c(a)||(e[t]=o.yS)})),e},w=(a,t)=>{const e=[];return Object.keys(t).filter((a=>t[a])).forEach(((t,n)=>{const s=u.filter((a=>t>=a.StartDate&&t<=a.EndDate));if(0===s.length)return;const r=[()=>[{grantId:s[0].PK,percent:100,hours:8}],()=>s.length>=2?[{grantId:s[0].PK,percent:60,hours:4.8},{grantId:s[1].PK,percent:40,hours:3.2}]:[{grantId:s[0].PK,percent:100,hours:8}],()=>s.length>=3?[{grantId:s[0].PK,percent:50,hours:4},{grantId:s[1].PK,percent:30,hours:2.4},{grantId:s[2].PK,percent:20,hours:1.6}]:[{grantId:s[0].PK,percent:100,hours:8}],()=>[{grantId:s[0].PK,percent:75,hours:6}]];r[(n+new Date(t).getDay())%r.length]().forEach((n=>{e.push({PK:a,SK:(0,o.generateTimeSlotKey)(t,n.grantId),AllocationPercent:n.percent,HoursAllocated:n.hours,Date:t,GrantID:n.grantId,UserID:a})}))})),e},b=async()=>{try{console.log("Starting database seeding..."),await o.db.transaction("rw",[o.db.individuals,o.db.grants,o.db.workdays,o.db.workdayHours,o.db.timeslots],(async()=>{await o.db.individuals.clear(),await o.db.grants.clear(),await o.db.workdays.clear(),await o.db.workdayHours.clear(),await o.db.timeslots.clear()})),console.log("Seeding individuals...");for(const n of l)await o.db.individuals.put(n);console.log("Seeding grants...");for(const n of u)await o.db.grants.put(n);const a=new Date("2025-01-01"),t=(0,d.p)(a),e=new Date("2025-02-01"),s=(0,d.p)(e);console.log("Seeding workdays and time slots...");for(const c of l){const r=g(a,t),i=y(a,t),d=g(e,s),l=y(e,s),u=(0,n.A)((0,n.A)({},r),d),b=(0,n.A)((0,n.A)({},i),l);await o.db.workdays.put({PK:c.PK,SK:(0,o.YA)(c.PK,2025),Workdays:u}),await o.db.workdayHours.put({PK:c.PK,SK:(0,o.generateWorkdayHoursKey)(c.PK,2025),Hours:b});const h=w(c.PK,u);for(const a of h)await o.db.timeslots.put(a)}console.log("Database seeding completed successfully!"),console.log("Seeded ".concat(l.length," individuals, ").concat(u.length," grants"));const r=await o.db.timeslots.count(),i=await o.db.workdays.count();console.log("Generated ".concat(i," workday records and ").concat(r," time slot allocations"))}catch(a){throw console.error("Database seeding failed:",a),a}},h=async()=>{try{console.log("Initializing IndexedDB database..."),await o.db.open(),console.log("Database opened successfully");const a=await(async()=>{try{return 0===await o.db.individuals.count()}catch(a){return console.error("Error checking database state:",a),!0}})();if(console.log("Database empty check:",a),a)console.log("Database is empty, auto-seeding..."),await b();else{console.log("Database already contains data, skipping auto-seed");const a={individuals:await o.db.individuals.count(),grants:await o.db.grants.count(),workdays:await o.db.workdays.count(),workdayHours:await o.db.workdayHours.count(),timeslots:await o.db.timeslots.count()};console.log("Current database counts:",a)}}catch(a){console.error("Database initialization failed:",a),console.log("Attempting to seed database anyway...");try{await b()}catch(t){console.error("Seeding also failed:",t)}}}}}]);
//# sourceMappingURL=550.6519a486.chunk.js.map